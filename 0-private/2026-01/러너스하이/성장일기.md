# 러너스하이 2기 성장일기: 이새힘
## 개요
- **진행기간 :** 2025. 12. 16 ~ 2016. 01. 15
- **해결문제 :** Resource 서버의 메모리 LEAK 관련 로그를 분석/추적하여 개선
- **개인적인 목표** 
	- 러너스하이 과정 완주하기.
	- 나를 성장시키는 선순환 프로세스를 인식하고 만드는 것.
	- 문제 인식과 해결에 객관적인 수치를 기반을 두는 것.
---
## 1주차 : 해결하고 싶은 문제 후보 검토
- 12. 16 ~ 12. 21

### 러너스하이 2기 가이드 세션
- 러너스하이 2기를 시작하며 가이드 세션의 가벼운 소감.
- 토스에서 '일을 잘 하는 사람'의 기준과 내부 평가 지표를 들을 수 있어서 인상깊었다.
	- 나는 지금 내 일의 가치를 객관적인 지표로 측정해가며 해왔는가?
	- 추상적인 느낌과 경험에 의한 직관에만 의존하지는 않았을지 반성해본다.
- 문제점을 파악하고 개선할수있는 사람은 꾸준히 성장하는 사람이 될 수 있다.
	- **나를 성장시키는 선순환 프로세스를 만드는 것을 목표**로 해보자.

### 같이 달리고 싶은 사람들을 찾아 주간 회고모임을 만듬
- 내가 일을 잘 하는 방식으로는 혼자 달리지 않는 것. 그리고 미리 나를 위한 환경을 만드는 것이다.
- 러너스하이 시스템상 커뮤니티를 별도로 구성하지는 않기 때문에, 스스로 구하기로했다.
- 첫번째 주에 이전에 활동하던 글또에서 서로 피어프레셔를 나눌 사람들을 구했고, 4주간의 시간동안 매주 일요일 밤에 온라인으로 모여 각자 했던 것을 공유하고 조언을 받았다.
- **최우선 목표는 러너스하이 완주이다.**

## 해결하고 싶은 문제들 검토
- 그동안 있었던 백로그, 기존에 느꼈던 불편함. 사내에서 있었던 요구사항들을 조합하여 다음의 해결 과제 후보를 정리하였다.
### 해결 과제 후보
1. Resource 서버 메모리릭 로그
2. 정기결제 환불 과정 자동화
- 주요 서비스 배포 Github Workflow 개선
	- `프로젝트 빌드 ➡️ 프로젝트 전체 테스트 통과 ➡️ AWS ECR 에 push` 흐름의 워크플로우 과정 중 테스트 통과에 약 17분은 소요 중.
	- 간헐적으로 실패하는 테스트가 있어서 어떤 경우에는 N번 연속 워크플로우 를 다시 시작해야했음.
- 주요 서비스에서 `Failed to obtain R2DBC Connection` 로그 문제파악 후 해결
	- DB 커넥션을 오래 가지고 있는 API 가 없는지 검토 필요.
- 알림 서비스 로직 리팩토링
	- `when` 으로 분기되는 600 라인 정도되는 컴포넌트 여러개가 있는 상태.
	- 신규 알림을 추가할 때 여러 컴포넌트를 수정해야하는데, 전략패턴 등을 사용하여 개선할 수 있을 것으로 보임.

---
## 2주차 : 해결 과제 선정 및 문제점 검토
- 12. 22 ~ 12. 28
## 각 해결과제 후보 ROI 검토
### Resource 서버 메모리릭 로그
- 2년간 반복된 로그가 Sentry 를 통해 주기적으로 오고 있고, 이 주기가 점점 짧아지고 있음.
```text
LEAK: ByteBuf.release() was not called before it's garbage-collected. See https://netty.io/wiki/reference-counted-objects.html for more information. .....
```
- 관련된 CS 요청이나 부차적인 REST API 요청 오류가 아직 없어서 긴 기간 백로그로만 있은지 오래된 상태.
- OOM 으로 인한 Restart 는 아직 관찰되지 않아 팀 내에서 별도 처리를 못한채로 
- 위험성이 내재되어있는 상태.
- **투입 리소스**
	- 2주동안 진행할 수 있는 규모
		- 원인 추적 및 재현 + 패치 배포 + 결과 확인
	- 재현 테스트 진행중에도 다른 작업을 할 수 있어 효율적으로 처리 가능
	- 이미 Sentry 를 통한 모니터링이 가능하므로 추가 모니터링 처리하지 않아도 됨.
- **얻을 수 있는 결과**
	- 내제된 위험성 제거
	- 오랜 기간 반복된 로그로 인한 모니터링 피로도 제거
	- 서비스 안정화
### 정기결제 환불 자동화
- 가장 자주 발생하는 CS가 정기결제 환불에 관한 건. 개발팀 뿐만 아니라 CS 담당자도 가장 시간을 많이 쓰고 있음.
- 개발팀 프로세스 : `DB 프로시저 ➡️ Provider API call ➡️ Jira ticket 상태 관리 ➡️ Jira 댓글 작성` 

## Resource 서버 문제상황 검토 및 실행 계획 세우기

---
## 3주차 : 로컬 환경에서 재현 시도 및 코드 수정

---
## 4주차 : 메모리 Leak 개선 PR 오픈 후 개발 서버 경과 추가

---
## 참고  링크
- [JVM 메모리 누수 트러블 슈팅](https://jobc.tistory.com/234)
- [토스 | SLASH 22 - Java Native Memory Leak 원인을 찾아서](https://www.youtube.com/watch?v=w4fWgLgop5U)
- [네이티브 메모리 누수 추적기](https://kangfru.tistory.com/24)
