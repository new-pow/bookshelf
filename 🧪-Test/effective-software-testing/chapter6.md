# 테스트 더블과 모의 객체
- 클래스간 종속성을 너무 신경쓰지 말고 격리된 방식으로 테스트하는 데 초점을 맞춘다.
- 테스트 대상 클래스를 구체적인 의존성과 함께 테스트 수행하는것은
	- 느리거나
	- 힘들거나
	- 너무 많은 일을 해야한다.
- 다른 클래스에 의존하는 클래스를 테스트할 때 의존성을 사용하지 않는 방법
	- 테스트 더블
		- 구성요소 B의 동작을 모방하는 객체를 생성하여 테스트 맥락에 따라 B처럼 행동할 수 있도록 한다.
- 다른 객체의 동작을 시뮬레이션 하는 객체를 사용하면 다음과 같은 장점이 있다.
	- 더 큰 제어권을 가진다.
	- 시뮬레이션은 빠르다.
	- 클래스간의 상호작용을 반영할 수 있다.
- 목표
	- 다른 단위에 크게 신경쓰지 않고 단윌 단위에 집중하게 한다.
## 6.1 더미, 페이크, 스텁, 모의 객체, 스파이
- 더미 객체
	- 테스트 대상 클래스에 전달되지만 절대 사용되지 않는 객체
- 페이크 객체
	- 시뮬레이션하려는 클래스 같이 실제로 동작하는 구현체를 가진다.
	- 다만 훨씬 단순한 방법으로 동작한다.
	- 예를 들어 실제 DB 대신 인메모리 DB를 사용하는 등
- 스텁
	- 테스트 과정에서 수행된 호출에 대해 하드 코딩된 응답을 제공한다.
- 모의 객체
	- 메서드 응답을 설정할 수 있다는 점에서 스텁같은 역할을 하지만
	- 모든 상호작용을 저장해서 나중에 단언문에 활용할 수 있도록 해준다.
- 스파이
	- 의존성을 감시한다.
	- 실제 객체를 감싸서 그 행동을 관찰한다.
	- 감시하고 있는 근본 객체와의 모든 상호작용을 기록한다.

  ## 6.3 현업에서의 모의 객체
  ### 단점
  - 모의 객체를 사용하는 것은 테스트 스위트가 코드가 아니라 모의 객체를 테스트하도록 만드는 것이 아닌가?
	  - 대규모 소프트웨어에서는 모의 객체가 클래스의 실제 계약을 표현하지 않을 수 있다는 점에서 모의 객체에 대한 제어권을 잃기 쉽다.
	  - 모의 객체가 대규모로 잘 동작하게 하려면 계약을 신경써서 설계해야한다.
  - 계약 변경이 일어난 의존성을 찾아서 테스트가 새로운 계약을 수행하는지 검사하는 것은 개발자가 해야하는 일이다.
	  - 이건 모의객체를 사용하지 않더라도 마찬가지이다.
	  - 이건 오히려 장점이 아닌가?
  - 테스트가 많이 알고 있으면 테스트 변경이 힘들 수 있다.
	  - 테스트를 단순하게 만들지만 테스트와 제품 코드간의 결합도를 증가시킨다.
### 모의해야하는 대상과 하지 말아야 하는 대상
- 모의해야할 때
	- 의존성이 너무 느린 경우 : 데이터베이스, 웹서비스 등
	- 의존성이 외부인프라와 통신하는 경우
	- 의존성을 시뮬레이션하기 힘든 경우
- 모의하지 않아야 할때
	- 엔티티
		- 공수가 더 많이 듬
	- 네이티브 라이브러리와 유틸리티 메서드
	- 충분히 단순한 의존성
### 날짜 및 시간 래퍼
- 모의할 수 있는 방법 알아두기
### 소유하지 않은 것을 모의하기
- 라이브러리와의 모든 상호작용을 캡슐화하는 추상화 객체 생성할 수 있다.
- 추상화 자체는 통합 테스트해야한다.
### 모의에 관한 외부 의견
- 테스트 더블을 사용하려면 시스템 테스트 가능성을 가지도록 설계해야 한다.
- 실제 구현에 충실하게 테스트 더블ㅇ르 구축하는 것은 어렵다. 하지만 가능한 그렇게 해야한다.
- 고립성보다 현실성이 낫다.
	- 가능하다면 페이크나 스텁, 모의 객체보다 실제 구현을 선택하도록 하자.
- 실제 구현을 사용하는 일이 불가능하거나 너무 비용이 많이 든다면 모의 객체보다 페이크를 사용한다.
- 모의를 너무 많이 사용하면 위험해질 수 있다.
	- 테스트가 이해하기 어려워지고
	- 깨지기 쉽고
	- 덜 효과적이다.
- 모의할 때는 상호작용 테스트보다 상태 테스트가 낫다.
- 너무 구체화된 상호작용 테스트는 피하자.
	- 인수 및 기능 테스트에 초점을 두자.
- 좋은 상호작용 테스트를 작성하려면 테스트 대상 시스템을 설계할 때 엄격한 지침이 필요하다.