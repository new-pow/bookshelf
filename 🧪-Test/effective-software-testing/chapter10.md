## 10. 테스트 코드 품질

좋은 테스트 코드는 단순히 "동작하는 테스트"가 아니라, **읽기 쉽고 유지보수하기 쉬운 코드**입니다. 이 챕터에서는 테스트 코드의 품질을 높이기 위한 원칙과, 피해야 할 테스트 코드의 냄새들을 소개합니다.

---

### 10.1 테스트 코드의 유지 보수성을 위한 원칙

**✅ 테스트는 빠르게 실행되어야 한다**  
느린 테스트는 개발 흐름을 끊고, 실행 빈도를 줄이게 됩니다. 느리다면 모의 객체(Mock)를 활용하거나, 별도의 느린 테스트 스위트로 분리해서 관리하세요.

**✅ 테스트는 응집력 있고, 독립적이며, 격리되어야 한다**  
하나의 테스트는 하나의 기능 또는 행위만 검증해야 합니다. 테스트 간에는 의존성이 없어야 하며, 어떤 순서로 실행해도 문제 없어야 합니다.

**✅ 테스트는 명확한 존재 이유가 있어야 한다**  
"일단 만들어두자"는 테스트는 결국 유지 보수의 짐이 됩니다. 실제로 코드의 동작을 보호하는 테스트만 작성하세요.

**✅ 테스트는 반복 가능하고 안정적이어야 한다**  
어떤 환경에서도 동일한 결과를 보장해야 합니다. 가끔 통과하고, 가끔 실패하는 테스트는 코드보다 테스트를 먼저 의심하게 만듭니다.

**✅ 단언문(Assert)은 확실해야 한다**  
단언문은 코드의 결과가 의도대로 나왔는지 확인하는 마지막 관문입니다. 핵심 행위가 바뀌면 반드시 테스트가 깨져야 합니다.

**✅ 행위 변경 시 테스트가 깨져야 한다**  
테스트가 깨졌다는 건 코드 변경이 의도된 대로 반영되었는지를 점검할 기회입니다. 코드가 변했는데 테스트가 멀쩡하다면, 보호받지 못하는 영역이 있다는 뜻입니다.

**✅ 테스트는 단 하나의 명확한 이유로 실패해야 한다**  
하나의 테스트가 실패하면, **무엇이 문제인지 단번에 알 수 있어야** 합니다. 책임이 분산되어 있다면 테스트를 쪼개세요.

**✅ 테스트는 작성하기 쉬워야 한다**  
단위 테스트는 상대적으로 쉽지만, 통합 테스트는 어렵습니다. 테스트 인프라를 잘 구축해서, **복잡한 시나리오도 쉽게 테스트할 수 있게** 만들어야 합니다.

**✅ 테스트는 읽기 쉬워야 한다**  
작성자는 물론, 동료 개발자도 쉽게 이해할 수 있도록 명확한 네이밍, 단순한 구조를 유지하세요. 테스트는 문서입니다.

**✅ 테스트는 쉽게 수정하고 진화할 수 있어야 한다**  
제품 코드가 바뀌면 테스트 코드도 함께 바뀝니다. 캡슐화와 리팩터링을 통해 테스트도 유연하게 대응할 수 있어야 합니다.

---

### 10.2 테스트 냄새

좋지 않은 테스트 코드는 다음과 같은 **‘냄새’를 풍깁니다**. 이런 코드들을 발견했다면 리팩터링 시점이란 신호입니다.

**😷 과도한 중복**  
여러 테스트에 반복되는 코드가 있다면, 공통된 설정 또는 헬퍼 메서드로 추출하세요. 테스트도 일반 코드처럼 리팩터링이 필요합니다.

**😷 불분명한 단언문**  
`assertThat(...).isTrue()` 같은 모호한 단언문은 테스트가 실패했을 때 원인을 파악하기 어렵게 만듭니다. 무엇을 검증하는지 명확하게 표현하세요.

**😷 외부 자원에 대한 부적절한 사용**  
네트워크, 파일 시스템, 데이터베이스 등 외부 의존성이 있는 테스트는 불안정할 수 있습니다. 가능하면 Mock, Stub 등으로 대체하거나 테스트 전용 환경을 구성하세요.

**😷 범용적인 픽스처(Fixture)**  
테스트에 사용되는 객체(입력값 집합)가 지나치게 범용적이면, 특정 테스트의 목적이 흐려지고, 유지 보수가 어려워집니다. **필요한 만큼만 구성**하세요.
